<!DOCTYPE html>
<html lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">

    <!-- hexo-inject:begin --><!-- hexo-inject:end --><!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="mbinary">



<meta name="description" content="B 树的原理与实现,b+ 树介绍">
<meta name="keywords" content="数据结构,B树,数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="『数据结构』B树(B-Tree)及其变体 B+树,B*树">
<meta property="og:url" content="https://mbinary.xyz/b-tree.html">
<meta property="og:site_name" content="mbinary&#39;s blog">
<meta property="og:description" content="B 树的原理与实现,b+ 树介绍">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-30342360fb9674b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-119c3bc27eee8ee6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-567cc0ffd8a4da80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-1f3e6003a5ccf800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-6a129fb2d32bda7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-517a256d15adb70d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/7130568-5dd763f4b28d853c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-01-30T11:05:28.531Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="『数据结构』B树(B-Tree)及其变体 B+树,B*树">
<meta name="twitter:description" content="B 树的原理与实现,b+ 树介绍">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/7130568-30342360fb9674b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="mbinary&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/yinyang.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>『数据结构』B树(B-Tree)及其变体 B+树,B*树 | mbinary&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->






</head></html>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">mbinary</a></h1>
        </hgroup>

        
        <p class="header-subtitle">淡泊明志, 宁静致远</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="Let me search for you>_<" class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/archives/">归档</a></li>
                        
                            <li><a href="/tags/">标签</a></li>
                        
                            <li><a href="/leetcode/">编程</a></li>
                        
                            <li><a href="/about/">关于</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Github" href="https://github.com/mbinary" title="Github"></a>
                            
                                <a class="fa Leetcode" href="https://leetcode-cn.com/mbinary/" title="Leetcode"></a>
                            
                                <a class="fa LinkedIn" href="http://www.linkedin.com/in/cs-heqin-zhu" title="LinkedIn"></a>
                            
                                <a class="fa Email" href="mailto:zhuheqin1@gmail.com" title="Email"></a>
                            
                                <a class="fa QQ" href="http://wpa.qq.com/msgrd?v=3&uin=414313516&site=qq&menu=yes" title="QQ"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/B树/">B树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/KMP/">KMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/USTC/">USTC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/common-lisp/">common lisp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/macro/">macro</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人际交往/">人际交往</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分享/">分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动态规划/">动态规划</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/区块链/">区块链</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图/">图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/娱乐/">娱乐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/字符串匹配/">字符串匹配</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/室友/">室友</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/影视/">影视</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/总结/">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/惰性学习/">惰性学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序/">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/操作系统/">操作系统</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/散列表/">散列表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数字货币/">数字货币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数学/">数学</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数论/">数论</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/斐波那契堆/">斐波那契堆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机械键盘/">机械键盘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/树/">树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/比特币/">比特币</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/汇编/">汇编</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/生活/">生活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/红黑树/">红黑树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/计算机组成原理/">计算机组成原理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书笔记/">读书笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/逆向/">逆向</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/选择/">选择</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑客/">黑客</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://mbinary.xyz/links/">交换友链说明</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://www.4spaces.org">4spaces</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">mbinary</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">mbinary</a></h1>
            </hgroup>
            
            <p class="header-subtitle">淡泊明志, 宁静致远</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/archives/">归档</a></li>
                
                    <li><a href="/tags/">标签</a></li>
                
                    <li><a href="/leetcode/">编程</a></li>
                
                    <li><a href="/about/">关于</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Github" target="_blank" href="https://github.com/mbinary" title="Github"></a>
                            
                                <a class="fa Leetcode" target="_blank" href="https://leetcode-cn.com/mbinary/" title="Leetcode"></a>
                            
                                <a class="fa LinkedIn" target="_blank" href="http://www.linkedin.com/in/cs-heqin-zhu" title="LinkedIn"></a>
                            
                                <a class="fa Email" target="_blank" href="mailto:zhuheqin1@gmail.com" title="Email"></a>
                            
                                <a class="fa QQ" target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin=414313516&site=qq&menu=yes" title="QQ"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-b-tree" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/b-tree.html" class="article-date">
      <time datetime="2018-08-29T07:42:00.000Z" itemprop="datePublished">2018-08-29</time>
</a>



    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      『数据结构』B树(B-Tree)及其变体 B+树,B*树
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/数据结构与算法/">数据结构与算法</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/B树/">B树</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <script src="/assets/js/APlayer.min.js"> </script><!-- TOC -->
<ul>
<li><a href="#1-背景">1. 背景</a></li>
<li><a href="#2-定义">2. 定义</a></li>
<li><a href="#3-查找操作">3. 查找操作</a></li>
<li><a href="#4-插入操作">4. 插入操作</a></li>
<li><a href="#5-删除操作">5. 删除操作</a><ul>
<li><a href="#51-第一种方法">5.1. 第一种方法</a></li>
<li><a href="#52-第二种方法">5.2. 第二种方法</a></li>
</ul>
</li>
<li><a href="#6-b树">6. B+树</a></li>
<li><a href="#7-b树">7. B*树</a></li>
<li><a href="#8-代码实现与测试">8. 代码实现与测试</a><ul>
<li><a href="#81-测试">8.1. 测试</a></li>
<li><a href="#82-python-实现">8.2. python 实现</a></li>
</ul>
</li>
<li><a href="#9-参考资料">9. 参考资料</a></li>
</ul>
<!-- /TOC -->
<p><a id="markdown-1-背景" name="1-背景"></a></p>
<blockquote>
<blockquote>
<p>从此心里有了B数(●’◡’●)</p>
</blockquote>
</blockquote>
<h1 id="1-背景"><a href="#1-背景" class="headerlink" title="1. 背景"></a>1. 背景</h1><p>当有大量数据储存在磁盘时,如数据库的查找,插入, 删除等操作的实现,  如果要读取或者写入, 磁盘的寻道, 旋转时间很长, 远大于在 内存中的读取,写入时间. </p>
<p>平时用的二叉排序树搜索元素的时间复杂度虽然是 $O(log_2n)$的, 但是底数还是太小, 树高太高. </p>
<p>所以就出现了 B 树(英文为B-Tree, 不是B减树), 可以理解为多叉排序树.  一个结点可以有多个孩子, 于是增大了底数, 减小了高度, 虽然比较的次数多(关键字数多), 但是由于是在内存中比较, 相较于磁盘的读取还是很快的.<br><a id="markdown-2-定义" name="2-定义"></a></p>
<h1 id="2-定义"><a href="#2-定义" class="headerlink" title="2. 定义"></a>2. 定义</h1><p>度为 <strong>d</strong>(degree)的 B 树(阶(order) 为 2d)  定义如下, </p>
<ol>
<li><p>每个结点中包含有 n 个关键字信息： $(n,P_0,K_1,P_1,K_2,\ldots,K_n,P_n)$。其中：</p>
<pre><code>a)   $K_i$为关键字,且关键字按顺序升序排序 $K_{i-1}&lt; K_i$
b)   $P_i$ 为指向子树根的接点, $K_{i-1}&lt;P(i-1) &lt; Ki$
c)   关键字的数 n 满足(由此也确定了孩子结点的个数): $d-1\leqslant n \leqslant 2d-1$ (根节点可以少于d-1)
</code></pre></li>
<li><p>树中每个结点最多含有 2d个孩子（d&gt;=2）；</p>
</li>
<li>除根结点和叶子结点外,其它每个结点至少有 d个孩子；</li>
<li>若根结点不是叶子结点,则至少有 2 个孩子（特殊情况：没有孩子的根结点,即根结点为叶子结点,整棵树只有一个根节点）；</li>
<li><strong>所有叶子结点都出现在同一层</strong>,叶子节点没有孩子和指向孩子的指针</li>
</ol>
<p>性质:<br>$h\leq \left\lfloor \log _{d}\left({\frac {n+1}{2}}\right)\right\rfloor .$</p>
<p>如下是 度为2的 B 树, 每个结点可能有2,3或4 个孩子, 所以也叫 2,3,4树, 等价于<a href="/red-black-tree.html#more">红黑树</a><br><img src="https://upload-images.jianshu.io/upload_images/7130568-30342360fb9674b4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><a id="markdown-3-查找操作" name="3-查找操作"></a></p>
<h1 id="3-查找操作"><a href="#3-查找操作" class="headerlink" title="3. 查找操作"></a>3. 查找操作</h1><p>可以看成二叉排序树的扩展,二叉排序树是二路查找,B - 树是多路查找。<br>节点内进行查找的时候除了顺序查找之外,还可以用二分查找来提高效率。</p>
<p>下面是顺序查找的 python 代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self,key,withpath=False)</span>:</span></span><br><span class="line">    nd = self.root</span><br><span class="line">    fathers = []</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        i = nd.findKey(key)</span><br><span class="line">        <span class="keyword">if</span> i==len(nd): fathers.append((nd,i<span class="number">-1</span>,i))</span><br><span class="line">        <span class="keyword">else</span>: fathers.append((nd,i,i))</span><br><span class="line">        <span class="keyword">if</span> i&lt;len(nd) <span class="keyword">and</span> nd[i]==key:</span><br><span class="line">            <span class="keyword">if</span> withpath:<span class="keyword">return</span> nd,i,fathers</span><br><span class="line">            <span class="keyword">else</span>:<span class="keyword">return</span> nd,i</span><br><span class="line">        <span class="keyword">if</span> nd.isLeafNode():</span><br><span class="line">            <span class="keyword">if</span> withpath:<span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">            <span class="keyword">else</span>:<span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">        nd = nd.getChd(i)</span><br></pre></td></tr></table></figure></p>
<p>我实现时让 fathers 记录查找的路径, 方便在实现 delete 操作时使用(虽然有种 delete 方法可以不需要, 直接 from up to down with no pass by),</p>
<p><a id="markdown-4-插入操作" name="4-插入操作"></a></p>
<h1 id="4-插入操作"><a href="#4-插入操作" class="headerlink" title="4. 插入操作"></a>4. 插入操作</h1><p>自顶向下地进行插入操作,  最终插入在叶子结点,<br>考虑到叶子结点如果有 2t-1 $(k_1,k_2,\ldots,k_{2t-1})$个 关键字, 则需要进行分裂, </p>
<p>一个有 2t-1$(k_1,k_2,\ldots,k_{2t-1})$个关键字 结点分裂是这样进行的:  此结点分裂为 两个关键字为 t-1个的结点, 分别为 $(k_1,k_2,\ldots,k_{t-1})$, $(k_{t+1},k_{t+2},\ldots,k_{2t-1})$, 然后再插入一个关键字$k_t$到父亲结点.</p>
<p>注意同时要将孩子指针移动正确.</p>
<p>所以自顶向下地查找到叶子结点, 中间遇到 2t-1个关键字的结点就进行分裂, 这样如果其子结点进行分裂,  上升来的一个关键字可以插入到父结点而不会超过2t-1</p>
<p>代码如下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self,key)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(self.root)== self.degree*<span class="number">2</span><span class="number">-1</span>:</span><br><span class="line">        self.root = self.root.split(node(isLeaf=<span class="keyword">False</span>),self.degree)</span><br><span class="line">        self.nodeNum +=<span class="number">2</span></span><br><span class="line">    nd = self.root</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        idx = nd.findKey(key)</span><br><span class="line">        <span class="keyword">if</span> idx&lt;len(nd) <span class="keyword">and</span> nd[idx] == key:<span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> nd.isLeafNode():</span><br><span class="line">            nd.insert(idx,key)</span><br><span class="line">            self.keyNum+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            chd = nd.getChd(idx)</span><br><span class="line">            <span class="keyword">if</span> len(chd)== self.degree*<span class="number">2</span><span class="number">-1</span>: <span class="comment">#ensure its keys won't excess when its chd split and u</span></span><br><span class="line">                nd = chd.split(nd,self.degree)</span><br><span class="line">                self.nodeNum +=<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nd = chd</span><br></pre></td></tr></table></figure></p>
<p><a id="markdown-5-删除操作" name="5-删除操作"></a></p>
<h1 id="5-删除操作"><a href="#5-删除操作" class="headerlink" title="5. 删除操作"></a>5. 删除操作</h1><p>删除操作是有点麻烦的, 有两种方法<sup><a href="#fn_1" id="reffn_1">1</a></sup></p>
<blockquote>
<ol>
<li>Locate and delete the item, then restructure the tree to retain its invariants, OR</li>
<li>Do a single pass down the tree, but before entering (visiting) a node, restructure the tree so that once the key to be deleted is encountered, it can be deleted without triggering the need for any further restructuring</li>
</ol>
</blockquote>
<p><a id="markdown-51-第一种方法" name="51-第一种方法"></a></p>
<h2 id="5-1-第一种方法"><a href="#5-1-第一种方法" class="headerlink" title="5.1. 第一种方法"></a>5.1. 第一种方法</h2><p>有如下情况</p>
<ul>
<li><p>删除结点在叶子结点上</p>
<ol>
<li>结点内的关键字个数大于d-1,可以直接删除（大于关键字个数下限,删除不影响 B - 树特性）</li>
<li><p>结点内的关键字个数等于d-1（等于关键字个数下限,删除后将破坏 特性）,此时需观察该节点左右兄弟结点的关键字个数：<br>a. <strong>旋转</strong>: 如果其左右兄弟结点中存在关键字个数大于d-1 的结点,则从关键字个数大于 d-1 的兄弟结点中借关键字：<strong>(这里看了网上的很多说法, 都是在介绍关键字的操作,而没有提到孩子结点.  我实现的时候想了很久才想出来:  借关键字时, 比如从右兄弟借一个关键字(第一个$k_1$), 此时即为左旋, 将父亲结点对应关键字移到当前结点, 再将右兄弟的移动父亲结点(因为要满足排序性质, 类似二叉树的选择) 然后进行孩子操作, 将右兄弟的$p_0$ 插入到 当前结点的孩子指针末尾) 左兄弟类似, <mark>而且要注意到边界条件, 比如当前结点是第0个/最后一个孩子, 则没有 左兄弟/右兄弟</mark></strong>)</p>
<p>b. <strong>合并</strong>: 如果其左右兄弟结点中不存在关键字个数大于 t-1 的结点,进行结点合并：将其父结点中的关键字拿到下一层,与该节点的左右兄弟结点的所有关键字合并<br><mark><strong>同样要注意到边界条件, 比如当前结点是第0个/最后一个孩子, 则没有 左兄弟/右兄弟</strong></mark></p>
</li>
<li><p>自底向上地检查来到这个叶子结点的路径上的结点是否满足关键字数目的要求, 只要关键字少于d-1,则进行旋转(2a)或者合并(2b)操作</p>
</li>
</ol>
</li>
<li>删除结点在非叶子结点上</li>
</ul>
<ol>
<li>查到到该结点, 然后转化成 上述 叶子结点中情况</li>
<li>转化过程：<br> a. 找到相邻关键字：即需删除关键字的左子树中的最大关键字或右子树中的最小关键字<br> b. 用相邻关键字来覆盖需删除的非叶子节点关键字,再删除原相邻关键字(在;叶子上,这即为上述情况)。</li>
</ol>
<p>python 代码如下,  <code>delete</code>函数中, 查找到结点, 用 <code>fathers::[(父节点, 关键字指针, 孩子指针)]</code> 记录路径,  如果不是叶子结点, 就再进行查找, 并记录结点, 转换关键字.</p>
<p>rebalance 就是从叶子结点自底向上到根结点, 只要遇到关键字数少于 2d-1 的,就进行平衡操作(旋转, 合并)</p>
<p>实现时要很仔细, 考虑边界条件, 还有当是左孩子的时候操作的是父结点的 chdIdx 的前一个, 是右孩子的时候是 chdIdx 的关键字. 具体实现完整代码见文末.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self,key)</span>:</span><span class="comment">#to do</span></span><br><span class="line">    <span class="string">'''search the key, delete it , and form down to up to rebalance it '''</span></span><br><span class="line">    nd,idx ,fathers= self.search(key,withpath=<span class="keyword">True</span>)</span><br><span class="line">    <span class="keyword">if</span> nd <span class="keyword">is</span> <span class="keyword">None</span> : <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">del</span> nd[idx]</span><br><span class="line">    self.keyNum-=<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():</span><br><span class="line">        chd = nd.getChd(idx) <span class="comment"># find the predecessor key</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span>  chd.isLeafNode():</span><br><span class="line">            fathers.append((chd,len(chd)<span class="number">-1</span>,len(chd)))</span><br><span class="line">            chd = chd.getChd(<span class="number">-1</span>)</span><br><span class="line">        fathers.append((chd,len(chd)<span class="number">-1</span>,len(chd)))</span><br><span class="line">        nd.insert(idx,chd[<span class="number">-1</span>])</span><br><span class="line">        <span class="keyword">del</span> chd[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> len(fathers)&gt;<span class="number">1</span>:self.rebalance(fathers)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rebalance</span><span class="params">(self,fathers)</span>:</span></span><br><span class="line">    nd,keyIdx,chdIdx = fathers.pop()</span><br><span class="line">    <span class="keyword">while</span> len(nd)&lt;self.degree<span class="number">-1</span>: <span class="comment"># rebalance tree from down to up</span></span><br><span class="line">        prt,keyIdx,chdIdx = fathers[<span class="number">-1</span>]</span><br><span class="line">        lbro = [] <span class="keyword">if</span> chdIdx==<span class="number">0</span> <span class="keyword">else</span> prt.getChd(chdIdx<span class="number">-1</span>)</span><br><span class="line">        rbro = [] <span class="keyword">if</span> chdIdx==len(prt) <span class="keyword">else</span> prt.getChd(chdIdx+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> len(lbro)&lt;self.degree <span class="keyword">and</span> len(rbro)&lt;self.degree:  <span class="comment"># merge two deficient nodes</span></span><br><span class="line">            beforeNode,afterNode = <span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">            <span class="keyword">if</span> lbro ==[]:</span><br><span class="line">                keyIdx = chdIdx</span><br><span class="line">                beforeNode,afterNode = nd,rbro</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                beforeNode,afterNode = lbro,nd</span><br><span class="line">                keyIdx = chdIdx<span class="number">-1</span>      <span class="comment"># important, when choosing</span></span><br><span class="line">            keys = beforeNode[:]+[prt[keyIdx]]+afterNode[:]</span><br><span class="line">            children = beforeNode.getChildren() + afterNode.getChildren()</span><br><span class="line">            isLeaf = beforeNode.isLeafNode()</span><br><span class="line">            prt.delChd(keyIdx+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">del</span> prt[keyIdx]</span><br><span class="line">            nd.update(keys,isLeaf,children)</span><br><span class="line">            prt.children[keyIdx]=nd</span><br><span class="line">            self.nodeNum -=<span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> len(lbro)&gt;=self.degree:  <span class="comment"># rotate  when only one sibling is deficient</span></span><br><span class="line">            keyIdx = chdIdx<span class="number">-1</span></span><br><span class="line">            nd.insert(<span class="number">0</span>,prt[keyIdx])    <span class="comment"># rotate keys</span></span><br><span class="line">            prt[keyIdx] =  lbro[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">del</span> lbro[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():     <span class="comment"># if not leaf, move children</span></span><br><span class="line">                nd.insert(<span class="number">0</span>,nd=lbro.getChd(<span class="number">-1</span>))</span><br><span class="line">                lbro.delChd(<span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            keyIdx = chdIdx</span><br><span class="line">            nd.insert(len(nd),prt[keyIdx])    <span class="comment"># rotate keys</span></span><br><span class="line">            prt[keyIdx] =  rbro[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">del</span> rbro[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():     <span class="comment"># if not leaf, move children</span></span><br><span class="line">                <span class="comment">#note that insert(-1,ele) will make the ele be the last second one</span></span><br><span class="line">                nd.insert(len(nd),nd=rbro.getChd(<span class="number">0</span>))</span><br><span class="line">                rbro.delChd(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> len(fathers)==<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> len(self.root)==<span class="number">0</span>:</span><br><span class="line">                self.root = nd</span><br><span class="line">                self.nodeNum -=<span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        nd,i,j = fathers.pop()</span><br></pre></td></tr></table></figure></p>
<p><a id="markdown-52-第二种方法" name="52-第二种方法"></a></p>
<h2 id="5-2-第二种方法"><a href="#5-2-第二种方法" class="headerlink" title="5.2. 第二种方法"></a>5.2. 第二种方法</h2><p>这是算法导论<sup><a href="#fn_2" id="reffn_2">2</a></sup>上的<br><img src="https://upload-images.jianshu.io/upload_images/7130568-119c3bc27eee8ee6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""><br><img src="https://upload-images.jianshu.io/upload_images/7130568-567cc0ffd8a4da80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>例如<br><img src="https://upload-images.jianshu.io/upload_images/7130568-1f3e6003a5ccf800.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">B-TREE-DELETE(T,k)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>  r ← root[T]</span><br><span class="line"> <span class="number">2</span>  <span class="keyword">if</span> n[r] = <span class="number">1</span></span><br><span class="line"> <span class="number">3</span>    then DISK_READ(c1[r])</span><br><span class="line"> <span class="number">4</span>       DISK_READ(c2[r])</span><br><span class="line"> <span class="number">5</span>       y ←c1[r]</span><br><span class="line"> <span class="number">6</span>       z ←c2[r]</span><br><span class="line"> <span class="number">7</span>       <span class="keyword">if</span> n[y] = n[z] = t<span class="number">-1</span>                   ▹ Cases <span class="number">2</span>c <span class="keyword">or</span> <span class="number">3</span>b</span><br><span class="line"> <span class="number">8</span>         then  B-TREE-MERGE-CHILD(r, <span class="number">1</span>, y, z) </span><br><span class="line"> <span class="number">9</span>            root[T] ← y</span><br><span class="line"> <span class="number">10</span>           FREE-NODE(r)</span><br><span class="line"> <span class="number">11</span>           B-TREE-DELETE-NONONE(y, k)</span><br><span class="line"><span class="number">12</span>      <span class="keyword">else</span> B-TREE-DELETE-NONONE (r, k)</span><br><span class="line"><span class="number">13</span> <span class="keyword">else</span> B-TREE-DELETE-NONONE (r, k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">考虑到根结点的特殊性,对根结点为<span class="number">1</span>,并且两个子结点都是t<span class="number">-1</span>的情况进行了特殊的处理：</span><br><span class="line">先对两个子结点进行合并,然后把原来的根删除,把树根指向合并后的子结点y。</span><br><span class="line">这样B树的高度就减少了<span class="number">1</span>。这也是B树高度唯一会减少的情况。 </span><br><span class="line">除了这种情况以外,就直接调用子过程 B-TREE-DELETE-NONONE (x, k)。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">B-TREE-DELETE-NONONE (x, k)</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>  i ← <span class="number">1</span></span><br><span class="line"> <span class="number">2</span>  <span class="keyword">if</span> leaf[x]                                       ▹ Cases <span class="number">1</span></span><br><span class="line"> <span class="number">3</span>     then <span class="keyword">while</span> i &lt;= n[x] <span class="keyword">and</span> k &gt; keyi[x]</span><br><span class="line"> <span class="number">4</span>            do i ← i + <span class="number">1</span></span><br><span class="line"> <span class="number">5</span>               <span class="keyword">if</span> k = keyi[x]</span><br><span class="line"> <span class="number">6</span>                 then <span class="keyword">for</span> j ← i+<span class="number">1</span> to n[x]</span><br><span class="line"> <span class="number">7</span>                        do keyj<span class="number">-1</span>[x] ←keyj[x]</span><br><span class="line"> <span class="number">8</span>                      n[x] ← n[x] - <span class="number">1</span></span><br><span class="line"> <span class="number">9</span>                      DISK-WRITE(x)</span><br><span class="line"> <span class="number">10</span>              <span class="keyword">else</span> error:”the key does <span class="keyword">not</span> exist”</span><br><span class="line"> <span class="number">11</span>    <span class="keyword">else</span> <span class="keyword">while</span> i &lt;= n[x] <span class="keyword">and</span> k &gt; keyi[x]</span><br><span class="line"><span class="number">12</span>           do i ← i + <span class="number">1</span></span><br><span class="line"> <span class="number">13</span>              DISK-READ(ci[x])</span><br><span class="line"> <span class="number">14</span>              y ←ci[x]</span><br><span class="line"> <span class="number">15</span>              <span class="keyword">if</span> i &lt;= n[x]</span><br><span class="line"> <span class="number">16</span>                then DISK-READ(ci+<span class="number">1</span>[x])</span><br><span class="line"> <span class="number">17</span>                     z ←ci+<span class="number">1</span>[x]</span><br><span class="line"> <span class="number">18</span>              <span class="keyword">if</span> k = keyi[x]                          ▹ Cases <span class="number">2</span></span><br><span class="line"><span class="number">19</span>                then <span class="keyword">if</span> n[y] &gt; t<span class="number">-1</span>                   ▹ Cases <span class="number">2</span>a</span><br><span class="line"> <span class="number">20</span>                       then k′←B-TREE-SEARCH-PREDECESSOR(y)</span><br><span class="line"> <span class="number">21</span>                            B-TREE-DELETE-NONONE (y, k′)</span><br><span class="line"> <span class="number">22</span>                            keyi[x] ←k′</span><br><span class="line"> <span class="number">23</span>                     <span class="keyword">else</span> <span class="keyword">if</span> n[z] &gt; t<span class="number">-1</span>               ▹ Cases <span class="number">2</span>b</span><br><span class="line"> <span class="number">24</span>                       then k′←B-TREE-SEARCH-SUCCESSOR (z)</span><br><span class="line"> <span class="number">25</span>                            B-TREE-DELETE-NONONE (z, k′)</span><br><span class="line"> <span class="number">26</span>                            keyi[x] ←k′</span><br><span class="line"> <span class="number">27</span>                     <span class="keyword">else</span> B-TREE-MERGE-CHILD(x, i, y, z)▹ Cases <span class="number">2</span>c</span><br><span class="line"> <span class="number">28</span>                          B-TREE-DELETE-NONONE (y, k)</span><br><span class="line"> <span class="number">29</span>              <span class="keyword">else</span>                                   ▹ Cases <span class="number">3</span></span><br><span class="line"> <span class="number">30</span>                <span class="keyword">if</span> i &gt;<span class="number">1</span></span><br><span class="line"> <span class="number">31</span>                  then DISK-READ(ci<span class="number">-1</span>[x])</span><br><span class="line"> <span class="number">32</span>                       p ←ci<span class="number">-1</span>[x]</span><br><span class="line"> <span class="number">33</span>                <span class="keyword">if</span> n[y] = t<span class="number">-1</span> </span><br><span class="line"> <span class="number">34</span>                  then <span class="keyword">if</span> i&gt;<span class="number">1</span> <span class="keyword">and</span> n[p] &gt;t<span class="number">-1</span>               ▹ Cases <span class="number">3</span>a</span><br><span class="line"> <span class="number">35</span>                         then B-TREE-SHIFT-TO-RIGHT-CHILD(x,i,p,y)</span><br><span class="line"> <span class="number">36</span>                       <span class="keyword">else</span> <span class="keyword">if</span> i &lt;= n[x] <span class="keyword">and</span> n[z] &gt; t<span class="number">-1</span>    ▹ Cases <span class="number">3</span>a</span><br><span class="line"> <span class="number">37</span>                         then B-TREE-SHIFT-TO-LEFT-CHILD(x,i,y,z)</span><br><span class="line"> <span class="number">38</span>                       <span class="keyword">else</span> <span class="keyword">if</span> i&gt;<span class="number">1</span>                       ▹ Cases <span class="number">3</span>b</span><br><span class="line"> <span class="number">39</span>                         then B-TREE-MERGE-CHILD(x, i, p, y)  </span><br><span class="line"> <span class="number">40</span>                              y ← p</span><br><span class="line"> <span class="number">41</span>                       <span class="keyword">else</span> B-TREE-MERGE-CHILD(x, i, y, z)▹ Cases <span class="number">3</span>b</span><br><span class="line"> <span class="number">42</span>                B-TREE-DELETE-NONONE (y, k)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> 转移到右边的子结点</span><br><span class="line">B-TREE-SHIFT-TO-RIGHT-CHILD(x,i,y,z)</span><br><span class="line"><span class="number">1</span> n[z] ← n[z] +<span class="number">1</span></span><br><span class="line"><span class="number">2</span> j ← n[z]</span><br><span class="line"><span class="number">3</span> <span class="keyword">while</span> j &gt; <span class="number">1</span></span><br><span class="line"><span class="number">4</span>   do keyj[z] ←keyj<span class="number">-1</span>[z]</span><br><span class="line"><span class="number">5</span>      j ← j <span class="number">-1</span></span><br><span class="line"><span class="number">6</span> key1[z] ←keyi[x]</span><br><span class="line"><span class="number">7</span> keyi[x] ←keyn[y][y]</span><br><span class="line"><span class="number">8</span> <span class="keyword">if</span> <span class="keyword">not</span> leaf[z]</span><br><span class="line"><span class="number">9</span>   then j ← n[z]</span><br><span class="line"><span class="number">10</span>       <span class="keyword">while</span> j &gt; <span class="number">0</span></span><br><span class="line"><span class="number">11</span>         do cj+<span class="number">1</span>[z] ←cj[z]</span><br><span class="line"><span class="number">12</span>            j ← j <span class="number">-1</span></span><br><span class="line"><span class="number">13</span>       c1[z] ←cn[y]+<span class="number">1</span>[y]</span><br><span class="line"><span class="number">14</span> n[y] ← n[y] <span class="number">-1</span></span><br><span class="line"><span class="number">15</span> DISK-WRITE(y)</span><br><span class="line"></span><br><span class="line"><span class="number">16</span> DISK-WRITE(z)</span><br><span class="line"></span><br><span class="line"><span class="number">17</span> DISK-WRITE(x)</span><br><span class="line"></span><br><span class="line">转移到左边的子结点</span><br><span class="line">B-TREE-SHIFT-TO-LEFT-CHILD(x,i,y,z)</span><br><span class="line"><span class="number">1</span> n[y] ← n[y] +<span class="number">1</span></span><br><span class="line"><span class="number">2</span> keyn[y][y] ← keyi[x]</span><br><span class="line"><span class="number">3</span> keyi[x] ←key1[z]</span><br><span class="line"><span class="number">4</span> n[z] ← n[z] <span class="number">-1</span></span><br><span class="line"><span class="number">5</span> j ← <span class="number">1</span></span><br><span class="line"><span class="number">6</span> <span class="keyword">while</span> j &lt;= n[z]</span><br><span class="line"><span class="number">7</span>   do keyj[z] ←keyj+<span class="number">1</span>[z]</span><br><span class="line"><span class="number">8</span>      j ← j +<span class="number">1</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">if</span> <span class="keyword">not</span> leaf[z]</span><br><span class="line"><span class="number">10</span>  then cn[y]+<span class="number">1</span>[y] ←c1[z]</span><br><span class="line"><span class="number">11</span>       j ← <span class="number">1</span></span><br><span class="line"><span class="number">12</span>       <span class="keyword">while</span> j &lt;= n[z]+<span class="number">1</span></span><br><span class="line"><span class="number">13</span>         do cj[z] ←cj+<span class="number">1</span>[z]</span><br><span class="line"><span class="number">14</span>            j ← j + <span class="number">1</span></span><br><span class="line"><span class="number">15</span> DISK-WRITE(y)</span><br><span class="line"></span><br><span class="line"><span class="number">16</span> DISK-WRITE(z)</span><br><span class="line"></span><br><span class="line"><span class="number">17</span> DISK-WRITE(x)</span><br></pre></td></tr></table></figure>
<p><a id="markdown-6-b树" name="6-b树"></a></p>
<h1 id="6-B-树"><a href="#6-B-树" class="headerlink" title="6. B+树"></a>6. B+树</h1><p> B+ 树<sup><a href="#fn_3" id="reffn_3">3</a></sup>是 B- 树的变体,与B树不同的地方在于:</p>
<ol>
<li>非叶子结点的子树指针与关键字个数相同；</li>
<li>非叶子结点的子树指针 $p_i$指向关键字值属于 $[k_i,k_{i+1})$ 的子树（B- 树是开区间）；</li>
<li>为所有叶子结点增加一个链指针；</li>
<li><p><strong>所有关键字都在叶子结点出现</strong></p>
<p>B+ 的搜索与 B- 树也基本相同,区别是 B+ 树只有达到叶子结点才命中（B- 树可以在非叶子结点命中）,其性能也等价于在关键字全集做一次二分查找；<br>下面摘自 wiki<sup><a href="#fn_4" id="reffn_4">4</a></sup><br>&gt;</p>
<blockquote>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><p>查找以典型的方式进行,类似于<a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" title="二叉查找树" target="_blank" rel="noopener">二叉查找树</a>。起始于根节点,自顶向下遍历树,选择其分离值在要查找值的任意一边的子指针。在节点内部典型的使用是<a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE" title="二分查找" target="_blank" rel="noopener">二分查找</a>来确定这个位置。</p>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>节点要处于违规状态,它必须包含在可接受范围之外数目的元素。</p>
<ol>
<li>首先,查找要插入其中的节点的位置。接着把值插入这个节点中。</li>
<li>如果没有节点处于违规状态则处理结束。</li>
<li>如果某个节点有过多元素,则把它分裂为两个节点,每个都有最小数目的元素。在树上递归向上继续这个处理直到到达根节点,如果根节点被分裂,则创建一个新根节点。为了使它工作,元素的最小和最大数目典型的必须选择为使最小数不小于最大数的一半。</li>
</ol>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ol>
<li>首先,查找要删除的值。接着从包含它的节点中删除这个值。</li>
<li>如果没有节点处于违规状态则处理结束。</li>
<li>如果节点处于违规状态则有两种可能情况：<ol>
<li>它的兄弟节点,就是同一个父节点的子节点,可以把一个或多个它的子节点转移到当前节点,而把它返回为合法状态。如果是这样,在更改父节点和两个兄弟节点的分离值之后处理结束。</li>
<li>它的兄弟节点由于处在低边界上而没有额外的子节点。在这种情况下把两个兄弟节点合并到一个单一的节点中,而且我们递归到父节点上,因为它被删除了一个子节点。持续这个处理直到当前节点是合法状态或者到达根节点,在其上根节点的子节点被合并而且合并后的节点成为新的根节点。</li>
</ol>
</li>
</ol>
</blockquote>
</li>
</ol>
<p>由于叶子结点间有指向下一个叶子的指针, 便于遍历, 以及区间查找, 所以数据库的以及操作系统文件系统的实现常用 B+树,<br><img src="https://upload-images.jianshu.io/upload_images/7130568-6a129fb2d32bda7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><a id="markdown-7-b树" name="7-b树"></a></p>
<h1 id="7-B-树"><a href="#7-B-树" class="headerlink" title="7. B*树"></a>7. B*树</h1><p>B<em>-tree <sup><a href="#fn_5" id="reffn_5">5</a></sup> 是 B+-tree 的变体,在 B+ 树的基础上 (所有的叶子结点中包含了全部关键字的信息,及指向含有这些关键字记录的指针),B </em> 树中非根和非叶子结点再增加指向兄弟的指针；B<em> 树定义了非叶子结点关键字个数至少为 (2/3)</em>M,即块的最低使用率为 2/3（代替 B+ 树的 1/2）</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7130568-517a256d15adb70d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p><a id="markdown-8-代码实现与测试" name="8-代码实现与测试"></a></p>
<h1 id="8-代码实现与测试"><a href="#8-代码实现与测试" class="headerlink" title="8. 代码实现与测试"></a>8. 代码实现与测试</h1><p><a href="https://github.com/mbinary/algorithm-in-python" target="_blank" rel="noopener">github地址</a></p>
<p><a id="markdown-81-测试" name="81-测试"></a></p>
<h2 id="8-1-测试"><a href="#8-1-测试" class="headerlink" title="8.1. 测试"></a>8.1. 测试</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">'__main__'</span>:</span><br><span class="line">    bt = bTree()</span><br><span class="line">    <span class="keyword">from</span> random <span class="keyword">import</span> shuffle,sample</span><br><span class="line">    n = <span class="number">20</span></span><br><span class="line">    lst = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(n)]</span><br><span class="line">    shuffle(lst)</span><br><span class="line">    test= sample(lst,len(lst)//<span class="number">4</span>)</span><br><span class="line">    print(<span class="string">f'building b-tree with  <span class="subst">&#123;lst&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">        bt.insert(i)</span><br><span class="line">        <span class="comment">#print(f'inserting &#123;i&#125;)</span></span><br><span class="line">        <span class="comment">#print(bt)</span></span><br><span class="line">    print(bt)</span><br><span class="line">    print(<span class="string">f'serching <span class="subst">&#123;test&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test:</span><br><span class="line">        nd,idx = bt.search(i)</span><br><span class="line">        print(<span class="string">f'node: <span class="subst">&#123;repr(nd)&#125;</span>[<span class="subst">&#123;idx&#125;</span>]== <span class="subst">&#123;i&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test:</span><br><span class="line">        print(<span class="string">f'deleting <span class="subst">&#123;i&#125;</span>'</span>)</span><br><span class="line">        bt.delete(i)</span><br><span class="line">        print(bt)</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/7130568-5dd763f4b28d853c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="bTree"></p>
<p><a id="markdown-82-python-实现" name="82-python-实现"></a></p>
<h2 id="8-2-python-实现"><a href="#8-2-python-实现" class="headerlink" title="8.2. python 实现"></a>8.2. python 实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,keys=None,isLeaf = True,children=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> keys <span class="keyword">is</span> <span class="keyword">None</span>:keys=[]</span><br><span class="line">        <span class="keyword">if</span> children <span class="keyword">is</span> <span class="keyword">None</span>: children =[]</span><br><span class="line">        self.keys = keys</span><br><span class="line">        self.isLeaf =  isLeaf</span><br><span class="line">        self.children = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self,i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.keys[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self,i)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.keys[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self,i,k)</span>:</span></span><br><span class="line">        self.keys[i] = k</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.keys)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self.keys)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        children = <span class="string">','</span>.join([str(nd.keys) <span class="keyword">for</span> nd <span class="keyword">in</span> self.children])</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'keys:     <span class="subst">&#123;self.keys&#125;</span>\nchildren: <span class="subst">&#123;children&#125;</span>\nisLeaf:   <span class="subst">&#123;self.isLeaf&#125;</span>'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getChd</span><span class="params">(self,i)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.children[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delChd</span><span class="params">(self,i)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.children[i]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setChd</span><span class="params">(self,i,chd)</span>:</span></span><br><span class="line">        self.children[i] = chd</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getChildren</span><span class="params">(self,begin=<span class="number">0</span>,end=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> end <span class="keyword">is</span> <span class="keyword">None</span>:<span class="keyword">return</span> self.children[begin:]</span><br><span class="line">        <span class="keyword">return</span> self.children[begin:end]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findKey</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i,k <span class="keyword">in</span> enumerate(self.keys):</span><br><span class="line">            <span class="keyword">if</span> k&gt;=key:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">return</span> len(self)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self,keys=None,isLeaf=None,children=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> keys <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:self.keys = keys</span><br><span class="line">        <span class="keyword">if</span> children <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:self.children = children</span><br><span class="line">        <span class="keyword">if</span> isLeaf <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: self.isLeaf = isLeaf</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self,i,key=None,nd=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:self.keys.insert(i,key)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.isLeaf <span class="keyword">and</span> nd <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: self.children.insert(i,nd)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isLeafNode</span><span class="params">(self)</span>:</span><span class="keyword">return</span> self.isLeaf</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(self,prt,t)</span>:</span></span><br><span class="line">        <span class="comment"># form new two nodes</span></span><br><span class="line">        k = self[t<span class="number">-1</span>]</span><br><span class="line">        nd1 = node()</span><br><span class="line">        nd2 = node()</span><br><span class="line">        nd1.keys,nd2.keys = self[:t<span class="number">-1</span>], self[t:] <span class="comment"># note that t is 1 bigger than  key index</span></span><br><span class="line">        nd1.isLeaf = nd2.isLeaf = self.isLeaf</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.isLeaf:</span><br><span class="line">            <span class="comment"># note that  children index is one bigger than key index, and all children included</span></span><br><span class="line">            nd1.children, nd2.children = self.children[<span class="number">0</span>:t], self.children[t:]</span><br><span class="line">        <span class="comment"># connect them to parent</span></span><br><span class="line">        idx = prt.findKey(k)</span><br><span class="line">        <span class="keyword">if</span> prt.children !=[]: prt.children.remove(self) <span class="comment"># remove the original node</span></span><br><span class="line">        prt.insert(idx,k,nd2)</span><br><span class="line">        prt.insert(idx,nd = nd1)</span><br><span class="line">        <span class="keyword">return</span> prt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bTree</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,degree=<span class="number">2</span>)</span>:</span></span><br><span class="line">        self.root = node()</span><br><span class="line">        self.degree=degree</span><br><span class="line">        self.nodeNum = <span class="number">1</span></span><br><span class="line">        self.keyNum = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self,key,withpath=False)</span>:</span></span><br><span class="line">        nd = self.root</span><br><span class="line">        fathers = []</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            i = nd.findKey(key)</span><br><span class="line">            <span class="keyword">if</span> i==len(nd): fathers.append((nd,i<span class="number">-1</span>,i))</span><br><span class="line">            <span class="keyword">else</span>: fathers.append((nd,i,i))</span><br><span class="line">            <span class="keyword">if</span> i&lt;len(nd) <span class="keyword">and</span> nd[i]==key:</span><br><span class="line">                <span class="keyword">if</span> withpath:<span class="keyword">return</span> nd,i,fathers</span><br><span class="line">                <span class="keyword">else</span>:<span class="keyword">return</span> nd,i</span><br><span class="line">            <span class="keyword">if</span> nd.isLeafNode():</span><br><span class="line">                <span class="keyword">if</span> withpath:<span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">                <span class="keyword">else</span>:<span class="keyword">return</span> <span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">            nd = nd.getChd(i)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self,key)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.root)== self.degree*<span class="number">2</span><span class="number">-1</span>:</span><br><span class="line">            self.root = self.root.split(node(isLeaf=<span class="keyword">False</span>),self.degree)</span><br><span class="line">            self.nodeNum +=<span class="number">2</span></span><br><span class="line">        nd = self.root</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            idx = nd.findKey(key)</span><br><span class="line">            <span class="keyword">if</span> idx&lt;len(nd) <span class="keyword">and</span> nd[idx] == key:<span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> nd.isLeafNode():</span><br><span class="line">                nd.insert(idx,key)</span><br><span class="line">                self.keyNum+=<span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                chd = nd.getChd(idx)</span><br><span class="line">                <span class="keyword">if</span> len(chd)== self.degree*<span class="number">2</span><span class="number">-1</span>: <span class="comment">#ensure its keys won't excess when its chd split and u</span></span><br><span class="line">                    nd = chd.split(nd,self.degree)</span><br><span class="line">                    self.nodeNum +=<span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    nd = chd</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self,key)</span>:</span><span class="comment">#to do</span></span><br><span class="line">        <span class="string">'''search the key, delete it , and form down to up to rebalance it '''</span></span><br><span class="line">        nd,idx ,fathers= self.search(key,withpath=<span class="keyword">True</span>)</span><br><span class="line">        <span class="keyword">if</span> nd <span class="keyword">is</span> <span class="keyword">None</span> : <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">del</span> nd[idx]</span><br><span class="line">        self.keyNum-=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():</span><br><span class="line">            chd = nd.getChd(idx) <span class="comment"># find the predecessor key</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span>  chd.isLeafNode():</span><br><span class="line">                fathers.append((chd,len(chd)<span class="number">-1</span>,len(chd)))</span><br><span class="line">                chd = chd.getChd(<span class="number">-1</span>)</span><br><span class="line">            fathers.append((chd,len(chd)<span class="number">-1</span>,len(chd)))</span><br><span class="line">            nd.insert(idx,chd[<span class="number">-1</span>])</span><br><span class="line">            <span class="keyword">del</span> chd[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> len(fathers)&gt;<span class="number">1</span>:self.rebalance(fathers)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rebalance</span><span class="params">(self,fathers)</span>:</span></span><br><span class="line">        nd,keyIdx,chdIdx = fathers.pop()</span><br><span class="line">        <span class="keyword">while</span> len(nd)&lt;self.degree<span class="number">-1</span>: <span class="comment"># rebalance tree from down to up</span></span><br><span class="line">            prt,keyIdx,chdIdx = fathers[<span class="number">-1</span>]</span><br><span class="line">            lbro = [] <span class="keyword">if</span> chdIdx==<span class="number">0</span> <span class="keyword">else</span> prt.getChd(chdIdx<span class="number">-1</span>)</span><br><span class="line">            rbro = [] <span class="keyword">if</span> chdIdx==len(prt) <span class="keyword">else</span> prt.getChd(chdIdx+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> len(lbro)&lt;self.degree <span class="keyword">and</span> len(rbro)&lt;self.degree:  <span class="comment"># merge two deficient nodes</span></span><br><span class="line">                beforeNode,afterNode = <span class="keyword">None</span>,<span class="keyword">None</span></span><br><span class="line">                <span class="keyword">if</span> lbro ==[]:</span><br><span class="line">                    keyIdx = chdIdx</span><br><span class="line">                    beforeNode,afterNode = nd,rbro</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    beforeNode,afterNode = lbro,nd</span><br><span class="line">                    keyIdx = chdIdx<span class="number">-1</span>      <span class="comment"># important, when choosing</span></span><br><span class="line">                keys = beforeNode[:]+[prt[keyIdx]]+afterNode[:]</span><br><span class="line">                children = beforeNode.getChildren() + afterNode.getChildren()</span><br><span class="line">                isLeaf = beforeNode.isLeafNode()</span><br><span class="line">                prt.delChd(keyIdx+<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">del</span> prt[keyIdx]</span><br><span class="line">                nd.update(keys,isLeaf,children)</span><br><span class="line">                prt.children[keyIdx]=nd</span><br><span class="line">                self.nodeNum -=<span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> len(lbro)&gt;=self.degree:  <span class="comment"># rotate  when only one sibling is deficient</span></span><br><span class="line">                keyIdx = chdIdx<span class="number">-1</span></span><br><span class="line">                nd.insert(<span class="number">0</span>,prt[keyIdx])    <span class="comment"># rotate keys</span></span><br><span class="line">                prt[keyIdx] =  lbro[<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">del</span> lbro[<span class="number">-1</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():     <span class="comment"># if not leaf, move children</span></span><br><span class="line">                    nd.insert(<span class="number">0</span>,nd=lbro.getChd(<span class="number">-1</span>))</span><br><span class="line">                    lbro.delChd(<span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                keyIdx = chdIdx</span><br><span class="line">                nd.insert(len(nd),prt[keyIdx])    <span class="comment"># rotate keys</span></span><br><span class="line">                prt[keyIdx] =  rbro[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">del</span> rbro[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> nd.isLeafNode():     <span class="comment"># if not leaf, move children</span></span><br><span class="line">                    <span class="comment">#note that insert(-1,ele) will make the ele be the last second one</span></span><br><span class="line">                    nd.insert(len(nd),nd=rbro.getChd(<span class="number">0</span>))</span><br><span class="line">                    rbro.delChd(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> len(fathers)==<span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> len(self.root)==<span class="number">0</span>:</span><br><span class="line">                    self.root = nd</span><br><span class="line">                    self.nodeNum -=<span class="number">1</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            nd,i,j = fathers.pop()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        head= <span class="string">'\n'</span>+<span class="string">'-'</span>*<span class="number">30</span>+<span class="string">'B  Tree'</span>+<span class="string">'-'</span>*<span class="number">30</span></span><br><span class="line">        tail= <span class="string">'-'</span>*<span class="number">30</span>+<span class="string">'the end'</span>+<span class="string">'-'</span>*<span class="number">30</span>+<span class="string">'\n'</span></span><br><span class="line">        lst = [[head],[<span class="string">f'node num: <span class="subst">&#123;self.nodeNum&#125;</span>,  key num: <span class="subst">&#123;self.keyNum&#125;</span>'</span>]]</span><br><span class="line">        cur = []</span><br><span class="line">        ndNum =<span class="number">0</span></span><br><span class="line">        ndTotal= <span class="number">1</span></span><br><span class="line">        que = [self.root]</span><br><span class="line">        <span class="keyword">while</span> que!=[]:</span><br><span class="line">            nd = que.pop(<span class="number">0</span>)</span><br><span class="line">            cur.append(repr(nd))</span><br><span class="line">            ndNum+=<span class="number">1</span></span><br><span class="line">            que+=nd.getChildren()</span><br><span class="line">            <span class="keyword">if</span> ndNum==ndTotal:</span><br><span class="line">                lst.append(cur)</span><br><span class="line">                cur = []</span><br><span class="line">                ndNum = <span class="number">0</span></span><br><span class="line">                ndTotal =len(que)</span><br><span class="line">        lst.append([tail])</span><br><span class="line">        lst = [<span class="string">','</span>.join(li) <span class="keyword">for</span> li <span class="keyword">in</span> lst]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'\n'</span>.join(lst)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self,nd = None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> nd <span class="keyword">is</span> <span class="keyword">None</span>: nd = self.root</span><br><span class="line">        que = [nd]</span><br><span class="line">        <span class="keyword">while</span> que !=[]:</span><br><span class="line">            nd = que.pop(<span class="number">0</span>) </span><br><span class="line">            <span class="keyword">yield</span> nd</span><br><span class="line">            <span class="keyword">if</span> nd.isLeafNode():<span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(len(nd)+<span class="number">1</span>):</span><br><span class="line">                que.append(nd.getChd(i))</span><br></pre></td></tr></table></figure>
<p><a id="markdown-9-参考资料" name="9-参考资料"></a></p>
<h1 id="9-参考资料"><a href="#9-参考资料" class="headerlink" title="9. 参考资料"></a>9. 参考资料</h1><blockquote id="fn_1">
<sup>1</sup>. <a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="noopener">B树</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. 算法导论<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a>
</blockquote>
<p><sup><a href="#fn_3" id="reffn_3">3</a></sup>:<a href="https://blog.csdn.net/u010842515/article/details/68487817" target="_blank" rel="noopener">B - 树特征及插入删除操作总结</a></p>
<blockquote id="fn_4">
<sup>4</sup>. <a href="https://zh.wikipedia.org/wiki/B%2B%E6%A0%91" target="_blank" rel="noopener">B+树</a><a href="#reffn_4" title="Jump back to footnote [4] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_5">
<sup>5</sup>. <a href="https://blog.csdn.net/v_JULY_v/article/details/6530142" target="_blank" rel="noopener">从 B 树、B + 树、B * 树谈到 R 树</a><a href="#reffn_5" title="Jump back to footnote [5] in the text."> &#8617;</a>
</blockquote>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/b-tree.html">『数据结构』B树(B-Tree)及其变体 B+树,B*树</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">mbinary</a></p>
        <p><span>发布时间:</span>2018-08-29, 15:42:00</p>
        <p><span>最后更新:</span>2019-01-30, 19:05:28</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/b-tree.html" title="『数据结构』B树(B-Tree)及其变体 B+树,B*树">https://mbinary.xyz/b-tree.html</a>
            <span class="copy-path" data-clipboard-text="原文: https://mbinary.xyz/b-tree.html　　作者: mbinary" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/fib-heap.html">
                    『数据结构』Fibonacci-heap
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/introduction-to-bitcoin.html">
                    『比特币』概述
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-背景"><span class="toc-number">1.</span> <span class="toc-text">1. 背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-定义"><span class="toc-number">2.</span> <span class="toc-text">2. 定义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-查找操作"><span class="toc-number">3.</span> <span class="toc-text">3. 查找操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-插入操作"><span class="toc-number">4.</span> <span class="toc-text">4. 插入操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-删除操作"><span class="toc-number">5.</span> <span class="toc-text">5. 删除操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-第一种方法"><span class="toc-number">5.1.</span> <span class="toc-text">5.1. 第一种方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-第二种方法"><span class="toc-number">5.2.</span> <span class="toc-text">5.2. 第二种方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-B-树"><span class="toc-number">6.</span> <span class="toc-text">6. B+树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#查找"><span class="toc-number">6.0.1.</span> <span class="toc-text">查找</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入"><span class="toc-number">6.0.2.</span> <span class="toc-text">插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除"><span class="toc-number">6.0.3.</span> <span class="toc-text">删除</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#7-B-树"><span class="toc-number">7.</span> <span class="toc-text">7. B*树</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-代码实现与测试"><span class="toc-number">8.</span> <span class="toc-text">8. 代码实现与测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-测试"><span class="toc-number">8.1.</span> <span class="toc-text">8.1. 测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-python-实现"><span class="toc-number">8.2.</span> <span class="toc-text">8.2. python 实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-参考资料"><span class="toc-number">9.</span> <span class="toc-text">9. 参考资料</span></a></li>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-6 i,
        .toc-level-6 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"『数据结构』B树(B-Tree)及其变体 B+树,B*树　| mbinary's blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
        <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>

<!--<script src="//cdn.jsdelivr.net/npm/leancloud-storage@latest/dist/av-min.js"></script>
<script src='//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js'></script>-->

<div id="vcomments"></div>
<script>
    var notify = false == true ? true : false;
    var verify = false == true ? true : false;
    var visitor = true == true ? true : false;
new Valine({
    el: '#vcomments',
    notify: notify,
    verify: verify,
    appId: 'ArpEYbLUBmpXK3f245hKNu4A-gzGzoHsz',
    appKey: 'X5cHcMU1ATb8q0prtPGEqIPX',
    lang: 'en',
    placeholder: '留下你的小脚印^_^ (支持 markdown, 上面三项 昵称,邮件(可用于回复),网址都是可选填的)',
    avatar: 'monsterid',
    pageSize: 10,
    visitor: visitor
    });
</script>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/fib-heap.html" title="上一篇: 『数据结构』Fibonacci-heap">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/introduction-to-bitcoin.html" title="下一篇: 『比特币』概述">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/number-theory.html">Number-Theory</a></li><li class="post-list-item"><a class="post-list-link" href="/string-matching.html">String-Mathching-Algorithm</a></li><li class="post-list-item"><a class="post-list-link" href="/graph.html">图算法</a></li><li class="post-list-item"><a class="post-list-link" href="/fib-heap.html">『数据结构』Fibonacci-heap</a></li><li class="post-list-item"><a class="post-list-link" href="/b-tree.html">『数据结构』B树(B-Tree)及其变体 B+树,B*树</a></li><li class="post-list-item"><a class="post-list-link" href="/introduction-to-bitcoin.html">『比特币』概述</a></li><li class="post-list-item"><a class="post-list-link" href="/introduction-to-blockchain.html">『区块链』简介</a></li><li class="post-list-item"><a class="post-list-link" href="/algorithm-general.html">『算法』概述</a></li><li class="post-list-item"><a class="post-list-link" href="/red-black-tree.html">『数据结构』红黑树(red-black tree)</a></li><li class="post-list-item"><a class="post-list-link" href="/tree.html">『数据结构』树</a></li><li class="post-list-item"><a class="post-list-link" href="/hashTable.html">『数据结构』散列表</a></li><li class="post-list-item"><a class="post-list-link" href="/sort.html">『算法』排序</a></li><li class="post-list-item"><a class="post-list-link" href="/bus.html">『计算机组成原理』总线</a></li><li class="post-list-item"><a class="post-list-link" href="/IO-device.html">『现代操作系统』IO设备</a></li><li class="post-list-item"><a class="post-list-link" href="/IO-software.html">『现代操作系统』IO软件原理</a></li><li class="post-list-item"><a class="post-list-link" href="/IO-hardware.html">『现代操作系统』IO硬件原理</a></li><li class="post-list-item"><a class="post-list-link" href="/os-general.html">『现代操作系统』操作系统引论</a></li><li class="post-list-item"><a class="post-list-link" href="/linux-file-io.html">『Unix环境高级编程』linux 文件 I/O</a></li><li class="post-list-item"><a class="post-list-link" href="/multiprocessor.html">『现代操作系统』多处理机</a></li><li class="post-list-item"><a class="post-list-link" href="/simple-shell.html">『linux』c 语言实现一个简易的 shell</a></li><li class="post-list-item"><a class="post-list-link" href="/deadlock.html">『现代操作系统』死锁</a></li><li class="post-list-item"><a class="post-list-link" href="/risk-predict.html">信用卡持卡人风险预测</a></li><li class="post-list-item"><a class="post-list-link" href="/comics-about-staying-up.html">『小仓鼠漫画』熬夜的危害与防护</a></li><li class="post-list-item"><a class="post-list-link" href="/ctf-basic.html">『CTF』网络信息安全攻防实验室之基础关 writeup</a></li><li class="post-list-item"><a class="post-list-link" href="/send-blog-automatically.html">『WEB』用 python 发送 csdn 博客</a></li><li class="post-list-item"><a class="post-list-link" href="/the-roommate-that-uses-mechanical-keyboard.html">用机械键盘的室友</a></li><li class="post-list-item"><a class="post-list-link" href="/csapp-bomb-lab-report.html">CSAPP-BOMB-LAB</a></li><li class="post-list-item"><a class="post-list-link" href="/learning-and-forgetting.html">学习与遗忘</a></li><li class="post-list-item"><a class="post-list-link" href="/20-years-old-summary.html">2017 年，20 岁，大二寒假总结与感悟</a></li><li class="post-list-item"><a class="post-list-link" href="/decrypt-netease-music.html">『WEB』从网易云音乐缓存文件得到MP3</a></li><li class="post-list-item"><a class="post-list-link" href="/all-one-data-structure.html">『数据结构』inc,dec,getMin,getMax 均为 O(1)</a></li><li class="post-list-item"><a class="post-list-link" href="/video.html">影视作品观后感</a></li><li class="post-list-item"><a class="post-list-link" href="/books.html">书籍总结与推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/common-lisp-macro.html">『common lisp』宏及函数的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/hacker-and-painter.html">『读书笔记』黑客与画家</a></li><li class="post-list-item"><a class="post-list-link" href="/from-chem-to-cs.html">从化院到计院</a></li><li class="post-list-item"><a class="post-list-link" href="/from-zhuzhong-to-ustc.html">从竹中到科大</a></li></ul>




    <script>
        
    </script>

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2017-2019 mbinary
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>

    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
            
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
<!-->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<--!>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
